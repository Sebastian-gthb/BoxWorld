10 CLS:WIDTH20,16:MEMSET&HB00:DEFINTA-Z:OPTIONBASE0:DIM A(16,16):DIM B(255,0)
20 LOCATE6,0:PRINT "Box World":PRINT" by Jeng-Long Jiang";:GOSUB700
30 PRINT"    HX-20 Version":PRINT"by Sebastian Berger";:GOSUB700
40 CLS:PRINT"Controls   ";CHR$(155);"W":PRINT"      <-A  ";CHR$(156);"S  D->"
50 PRINT"R=restart  O=off":PRINT"P=print level";:GOSUB700
60 POKE&H11E,&HA:POKE&H11F,&H40:RESTORE800:FORI=&HA40 TO&HA6F:READJ:POKEI,J:NEXTI
66 ' Level * 10 + 900 = line with map data
67 ' L=1:M=L*10+900:PRINTM:RESTORE M:READX+1:READY+1:READX1:READY1
70 ' L=level, C=boxes not on target (0=level completed)
80 CLS:INPUT"LEVEL  (1-20)";L:IFL<1ORL>20THENSOUND1,1:GOTO80
90 C=0:ONL GOSUB440,450,460,470,480,490,500,510,520,530,540,550,560,570,580,590,600,610,620,630
100 READX:READY:READX1:READY1:FORJ=0TO15:FORI=0TO15:A(I,J)=0:NEXT I,J
110 B=(X+1)*(Y+1):Z=0
120 READ D:IFD>11THENEND
130 IFD>9THEND=D-8:E=5:GOTO170
140 IFD>7THEND=D-6:E=1:GOTO170
150 IFD>5THEND=D-4:E=0:GOTO170
160 B(Z,0)=D:Z=Z+1:GOTO180
170 FORI=1TOD:B(Z,0)=E:Z=Z+1:NEXTI
180 IFZ<BGOTO120
190 Z=0:A$=INKEY$:A$=INKEY$:A$=INKEY$:A$=INKEY$
200 CLS:FOR J=0 TO Y :LOCATE 0,J :FOR I=0 TO X: A(I,J)=B(Z,0):Z=Z+1 :IF A(I,J)=3 THEN C=C+1
210 PRINTCHR$(224+A(I,J));:NEXT I,J
220 LOCATES0,Y1-1,0:LOCATE X1,Y1:PRINTCHR$(154);
230 A$=INPUT$(1):IFA$="D"THENX2=X1+1:X3=X1+2:Y2=Y1:Y3=Y1:GOTO310
240 IFA$="A"THENX2=X1-1:X3=X1-2:Y2=Y1:Y3=Y1:GOTO310
250 IFA$="W"THENY2=Y1-1:Y3=Y1-2:X2=X1:X3=X1:GOTO310
260 IFA$="S"THENY2=Y1+1:Y3=Y1+2:X2=X1:X3=X1:GOTO310
270 IFA$="R"THEN90
280 IFA$="P"THENV=0:GOSUB420:GOTO230
290 IFA$="O"THEN410
300 SOUND1,1:GOTO 230
310 ONA(X2,Y2)GOSUB370,370,330,330,710
320 IFC=0THEN400ELSE230
329 ' opt. IF A(X3,Y3) > 2 THEN 710
330 ON A(X3,Y3) GOSUB 340,340,710,710,710 : RETURN
340 IF A(X2,Y2)=3 AND A(X3,Y3)=2 THEN C=C-1
350 IF A(X2,Y2)=4 AND A(X3,Y3)=1 THEN C=C+1
360 A(X3,Y3)=A(X3,Y3)+2 : A(X2,Y2)=A(X2,Y2)-2
370 IF Y1<Y2 THEN LOCATES0,Y1-1,0
380 LOCATEX1,Y1:PRINTCHR$(224+A(X1,Y1));:LOCATEX2,Y2:PRINTCHR$(154);
390 LOCATEX3,Y3:PRINTCHR$(224+A(X3,Y3));:X1=X2:Y1=Y2:RETURN
400 GOSUB700:L=L+1:IFL<21THEN90
410 CLS:END
420 LOCATES0,V:COPY:V=V+4:IFV<YTHEN420
430 LOCATES0,Y1-1,0:RETURN
440 RESTORE 850:RETURN
450 RESTORE 860:RETURN
460 RESTORE 880:RETURN
470 RESTORE 890:RETURN
480 RESTORE 900:RETURN
490 RESTORE 1140:RETURN
500 RESTORE 1140:RETURN
510 RESTORE 1140:RETURN
520 RESTORE 1140:RETURN
530 RESTORE 1140:RETURN
540 RESTORE 1140:RETURN
550 RESTORE 1140:RETURN
560 RESTORE 1140:RETURN
570 RESTORE 1140:RETURN
580 RESTORE 1140:RETURN
590 RESTORE 1140:RETURN
600 RESTORE 1140:RETURN
610 RESTORE 1140:RETURN
620 RESTORE 1140:RETURN
630 RESTORE 1140:RETURN
700 FORI=1TO28:J=I^2-56*(I^2\56):SOUNDJ,1:NEXTI:RETURN
710 SOUND1,1:RETURN
800 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,66,36,24,36,66,0,255,249,189,159,255,0,255,135,195
810 DATA 225,255,119,7,119,119,112,119,0,198,40,31,107,136,0,0,0,0,0,0,0,0,0,0,0,0
820 ' X-Size-1 of map, Y-Site-1 of map, X-Start of player, Y-Start of player
830 ' map data 0=outside 1=floor 2=target 3=box 4=box on target 5=wall
840 ' 6,7=2x,3x Outside; 8,9=2x,3x floor; 10,11=2x,3x wall
850 DATA 7,7,4,4,6,11,7,6,5,2,5,7,6,5,1,11,11,5,3,1,3,2,10,2,1,3,1,11,11,5,3,5,7,6,5,2,5,7,6,11,6
860 DATA 8,8,1,1,11,10,7,0,5,9,5,7,0,5,1,3,3,5,0,11,5,1,3,1,5,0,5,2,11,5,1,11,2,5
870 DATA 0,10,9,1,2,5,0,5,9,5,8,5,0,5,9,11,5,0,11,10,7
880 DATA 9,6,2,3,0,11,11,5,7,5,9,8,11,10,3,11,9,10,9,3,8,3,1,10,1,2,2,5,1,3,1,11,5,2,2,5,1,1,1,5,6,11,11,10,0
890 DATA 5,7,1,2,0,11,5,0,10,8,5,0,5,1,3,1,5,0,10,3,1,11,5,1,3,1,10,2,3,8,10,2,2,4,2,11,11,5
900 DATA 5,7,1,2,0,11,5,7,0,5,1,1,11,6,5,1,3,8,5,0,11,1,5,1,11,2,5,1,5,8,10,2,3,8,5,1,10,2,9,3,1,11,11,11
930 DATA 0,0,0,5,5,5,5,5,5,5,0,0,0,5,5,5,5,1,1,1,1,1,5,0,0,0,5,1,1,1,2,5,5,5,1,5,0,0,0
940 DATA 5,1,5,1,5,1,1,1,1,5,5,0,0,5,1,5,1,3,1,3,5,2,1,5,0,0,5,1,5,1,1,4,1,1,5,1,5,0,0
950 DATA 5,1,2,5,3,1,3,1,5,1,5,0,0,5,5,1,1,1,1,5,1,5,1,5,5,5,0,5,1,5,5,5,2,1,1,1,1,1,5
960 DATA 0,5,1,1,1,1,1,5,5,1,1,1,5,0,5,5,5,5,5,5,5,5,5,5,5,5
970 DATA 0,0,0,5,5,5,5,5,5,5,0,0,5,5,1,1,5,1,1,5,0,0,5,1,1,1,5,1,1,5,0,0,5,3,1,3,1,3,1,5
980 DATA 0,0,5,1,3,5,5,1,1,5,5,5,5,1,3,1,5,1,5,5,5,2,2,2,2,2,1,1,5,0,5,5,5,5,5,5,5,5,5,0
990 DATA 0,0,0,5,5,5,5,5,5,0,0,5,5,5,1,1,1,1,5,0,5,5,2,1,3,5,5,1,5,5,5,2,2,3,1,3,1,1,1,5
1000 DATA 5,2,2,1,3,1,3,1,5,5,5,5,5,5,5,5,1,1,5,0,0,0,0,0,0,5,5,5,5,0
1010 DATA 0,5,5,5,5,5,5,5,5,5,0,0,5,1,1,5,5,1,1,1,5,0,0,5,1,1,1,3,1,1,1,5,0
1020 DATA 0,5,3,1,5,5,5,1,3,5,0,0,5,1,5,2,2,2,5,1,5,0,5,5,1,5,2,2,2,5,1,5,5
1030 DATA 5,1,3,1,1,3,1,1,3,1,5,5,1,1,1,1,1,5,1,1,1,5,5,5,5,5,5,5,5,5,5,5,5
1040 DATA 0,0,5,5,5,5,5,5,0,0,5,1,1,1,1,5,5,5,5,3,3,3,1,5,5,1,1,3,2,2,1,5
1050 DATA 5,1,3,2,2,2,5,5,5,5,5,5,1,1,5,0,0,0,0,5,5,5,5,0
1060 DATA 0,5,5,5,5,0,0,5,5,5,5,5,5,5,1,1,5,0,0,5,1,1,1,5,5,1,3,1,5,5,5,5,3,1,1,5
1070 DATA 5,1,1,3,2,2,2,2,1,3,1,5,5,5,1,1,1,1,5,1,1,1,5,5,0,5,5,5,5,5,5,5,5,5,5,0
1080 DATA 0,0,5,5,5,5,5,0,5,5,5,1,1,1,5,0,5,1,1,3,2,1,5,5,5,1,1,2,3,2,1,5
1090 DATA 5,5,5,1,4,3,1,5,0,0,5,1,1,1,5,5,0,0,5,5,5,5,5,0
1100 DATA 0,0,5,5,5,5,0,0,0,0,5,2,2,5,0,0,0,5,5,1,2,5,5,0,0,5,1,1,3,2,5,0
1110 DATA 5,5,1,3,1,1,5,5,5,1,1,5,3,3,1,5,5,1,1,1,1,1,1,5,5,5,5,5,5,5,5,5
1120 DATA 5,5,5,5,5,5,5,5,5,1,1,5,1,1,1,5,5,1,3,2,2,3,1,5,5,1,3,2,4,1,5,5,5
1130 DATA 1,3,2,2,3,1,5,5,1,1,5,1,1,1,5,5,5,5,5,5,5,5,5
1140 DATA 15,15,4,4,11,11,11,11,11,10,9,9,9,9,8,10,9,9,9,9,2,1,10,9,9,9,8,2,8,10
1150 DATA 9,9,9,1,2,9,10,9,9,9,2,9,1,10,9,9,8,2,9,8,10,9,9,1,2,9,9,10,9,9,5,9,9
1160 DATA 1,10,9,8,3,9,9,8,10,9,1,3,8,3,9,9,10,9,3,9,9,9,1,10,8,3,9,9,9,8,10,1,3
1170 DATA 9,9,9,9,10,9,9,9,9,8,11,11,11,11,11,10
1180 'EOF