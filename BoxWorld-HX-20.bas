10 CLS:WIDTH20,16:MEMSET&HB00:DEFINTA-Z:OPTIONBASE0:DIM A(16,16):DIM B(255,0)
20 LOCATE6,0:PRINT "Box World":PRINT" by Jeng-Long Jiang";:GOSUB800
30 PRINT"    HX-20 Version":PRINT"by Sebastian Berger";:GOSUB800
40 CLS:PRINT"Controls   ";CHR$(155);"W":PRINT"      <-A  ";CHR$(156);"S  D->"
50 PRINT"R=restart  O=off":PRINT"P=print level";:GOSUB800
60 POKE&H11E,&HA:POKE&H11F,&H40
70 RESTORE900:FORI=&HA40 TO&HA6F:READJ:POKEI,J:NEXTI
76 ' Level * 10 + 900 = line with map data
77 ' L=1:M=L*10+900:PRINTM:RESTORE M:READX+1:READY+1:READX1:READY1
78 ' L=level, C=boxes not on target (0=level completed)
90 C=0 : CLS : INPUT "LEVEL  (1-2)";L : IF L<1 OR L>2 THEN SOUND1,1 : GOTO80
100 ON L GOSUB 700,701
110 READX:READY:READX1:READY1:FORJ=0TO15:FORI=0TO15:A(I,J)=0:NEXT I,J
111 B=(X+1)*(Y+1):Z=0
112 READ D: IF D >11 THEN END
113 IFD>9 THEN D=D-8 : E=5 : GOTO 117
114 IFD>7 THEN D=D-6 : E=1 : GOTO 117
115 IFD>5 THEN D=D-4 : E=0 : GOTO 117
116 B(Z,0)=D : Z=Z+1 :GOTO 118
117 FOR I=1 TO D : B(Z,0)=E : Z=Z+1 : NEXT I
118 IF Z < B GOTO 112
131 Z=0:A$=INKEY$:A$=INKEY$:A$=INKEY$:A$=INKEY$
132 CLS:FOR J=0 TO Y :LOCATE 0,J :FOR I=0 TO X: A(I,J)=B(Z,0):Z=Z+1 :IF A(I,J)=3 THEN C=C+1
133 PRINTCHR$(224+A(I,J));:NEXT I,J
140 LOCATES0,Y1-1,0:LOCATE X1,Y1:PRINTCHR$(154);
150 A$=INPUT$(1)
160 IF A$="D" THEN X2=X1+1:X3=X1+2:Y2=Y1:Y3=Y1:GOTO240
170 IF A$="A" THEN X2=X1-1:X3=X1-2:Y2=Y1:Y3=Y1:GOTO240
180 IF A$="W" THEN Y2=Y1-1:Y3=Y1-2:X2=X1:X3=X1:GOTO240
190 IF A$="S" THEN Y2=Y1+1:Y3=Y1+2:X2=X1:X3=X1:GOTO240
200 IF A$="R" THEN 100
210 IF A$="P" THEN V=0:GOSUB400:GOTO150
220 IF A$="O" THEN 360
230 SOUND1,1 : GOTO 150
240 ON A(X2,Y2) GOSUB 330,330,300,300,810
250 IF C=0 THEN 350 ELSE 150
300 ON A(X3,Y3) GOSUB 320,320,810,810,810 : RETURN
320 IF A(X2,Y2)=3 AND A(X3,Y3)=2 THEN C=C-1
321 IF A(X2,Y2)=4 AND A(X3,Y3)=1 THEN C=C+1
325 A(X3,Y3)=A(X3,Y3)+2 : A(X2,Y2)=A(X2,Y2)-2
330 IF Y1<Y2 THEN LOCATES0,Y1-1,0
340 LOCATEX1,Y1:PRINTCHR$(224+A(X1,Y1));
341 LOCATEX2,Y2:PRINTCHR$(154);
342 LOCATEX3,Y3:PRINTCHR$(224+A(X3,Y3));:X1=X2:Y1=Y2:RETURN
350 GOSUB800: L=L+1 : IF L<3 THEN 100
360 CLS:END
400 LOCATES0,V:COPY:V=V+4:IF V<Y THEN 400
410 LOCATES0,Y1-1,0:RETURN
700 RESTORE 910:RETURN
701 RESTORE 920:RETURN
800 FORI=1TO28:J=I^2-56*(I^2\56):SOUNDJ,1:NEXTI:RETURN
810 SOUND1,1:RETURN
900 DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,66,36,24,36,66,0,255,249,189,159,255,0,255,135,195
901 DATA 225,255,119,7,119,119,112,119,0,198,40,31,107,136,0,0,0,0,0,0,0,0,0,0,0,0
907 ' X-Size-1 of map, Y-Site-1 of map, X-Start of player, Y-Start of player
908 ' map data 0=outside 1=floor 2=target 3=box 4=box on target 5=wall
909 ' 6,7=2x,3x Outside; 8,9=2x,3x floor; 10,11=2x,3x wall
910 DATA 7,7,4,4,6,11,7,6,5,2,5,7,6,5,1,11,11,5,3,1,3,2,10,2,1,3,1,11,11,5,3,5,7,6,5,2,5,7,6,11,6
920 DATA 15,15,4,4,11,11,11,11,11,10,9,9,9,9,8,10,9,9,9,9,2,1,10,9,9,9,8,2,8,10
921 DATA 9,9,9,1,2,9,10,9,9,9,2,9,1,10,9,9,8,2,9,8,10,9,9,1,2,9,9,10,9,9,5,9,9
922 DATA 1,10,9,8,3,9,9,8,10,9,1,3,8,3,9,9,10,9,3,9,9,9,1,10,8,3,9,9,9,8,10,1,3
923 DATA 9,9,9,9,10,9,9,9,9,8,11,11,11,11,11,10
990 'EOF